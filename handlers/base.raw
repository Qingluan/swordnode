import os


TEST_DIR = os.path.expanduser("~/.config/SwordNode/plugins/Plugins")
TEST_MODULES_ROOT = os.path.expanduser("~/.config/SwordNode/plugins/Plugins")

if not os.path.exists(os.path.join(TEST_MODULES_ROOT,'.git')):
    os.popen("cd %s && git init " % TEST_MODULES_ROOT)
    os.popen("cd %s && git remote add origin https://github.com/Qingluan/x-plugins.git"  % TEST_MODULES_ROOT)


def run(cmd):
    if cmd == 'ls':
        res = os.popen('ls %s' % os.path.dirname(__file__)).read()
    elif cmd == 'update':
        res = os.popen('cd %s && git add -A && git commit -m "123" && git pull -f origin master --allow-unrelated-histories' % TEST_DIR).read()
    elif cmd == 'updateF':
        res = os.popen('cd %s && git add -A && git commit -m "123" && git pull -f origin master --allow-unrelated-histories' % TEST_DIR).read()
    elif cmd == 'upgrade':
        res = os.popen("pip3 install -U git+https://github.com/Qingluan/swordnode.git && sleep 1 && x-neid-server stop && x-neid-server start").read()
    elif cmd == 'ps':
        res = os.popen("ps aux | grep -v grep").read()
    return res